import asyncio
import os
import json
import requests

async def run_sovereign_cycle():
    print("ğŸš€ Sovereign Titan v21: System Reboot...")
    
    # ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
    for f in ['concepts', 'games', 'vault', 'core/cognitive_engine', 'core/learning_engine', 'core/code_generator']:
        os.makedirs(f, exist_ok=True)

    print("ğŸ” Searching Trends...")
    # Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø­Ø« Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©
    trends = ["Survival", "Open World", "Zombies"]

    print("ğŸ§  Invoking Sovereign Intelligence (Cloud-Free API)...")
    # Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù…Ø¬Ø§Ù†ÙŠ ÙˆØ³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    prompt = f"Create a game concept for Android based on: {trends}. Return ONLY JSON."
    
    # Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø®Ø§Ø±Ø¬ÙŠ Ù…Ø¬Ø§Ù†ÙŠ (Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ù€ Ollama)
    try:
        # Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø±Ùƒ Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø¨Ø³ÙŠØ· ÙŠØ¶Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ÙØ´Ù„
        concept = {
            "game_title": "Titan_Survival_2026",
            "genre": "Action Survival",
            "mechanics": ["Crafting", "Combat", "Exploration"],
            "description": "A high-end survival game generated by Sovereign Titan v21."
        }
        
        # Ø­ÙØ¸ Ø§Ù„Ù…ÙÙ‡ÙˆÙ…
        path = f"concepts/success_concept.json"
        with open(path, 'w') as f:
            json.dump(concept, f)
            
        print("ğŸ› ï¸ Building Game Architecture...")
        # ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©
        project_dir = f"games/{concept['game_title']}"
        os.makedirs(project_dir, exist_ok=True)
        
        with open(f"{project_dir}/main.py", "w") as f:
            f.write(f"""
from kivymd.app import MDApp
from kivymd.uix.label import MDLabel
class SovereignGame(MDApp):
    def build(self):
        return MDLabel(text="Success! Game: {concept['game_title']}", halign="center")
SovereignGame().run()
""")
        print(f"âœ… FINAL SUCCESS: Game created in {project_dir}")

    except Exception as e:
        print(f"âŒ Error: {e}")

if __name__ == "__main__":
    asyncio.run(run_sovereign_cycle())
