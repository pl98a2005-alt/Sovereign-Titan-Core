name: Sovereign_Titan_Complete_Production
on: 
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  production:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ğŸ§  Install Ollama & Phi-3 (Lighter AI)
        run: |
          curl -fsSL https://ollama.com/install.sh | sh
          ollama serve & 
          sleep 30
          ollama pull phi3:mini # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ Ø£ØµØºØ± Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±

      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install buildozer cython

      - name: ğŸ›°ï¸ Run Sovereign Factory
        run: python main.py

      - name: ğŸ› ï¸ Build Android APK
        run: |
          # ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù buildozer.spec ÙÙŠ Ù…Ø³ØªÙˆØ¯Ø¹Ùƒ
          if [ -f buildozer.spec ]; then
            yes | buildozer -v android debug
          else
            echo "buildozer.spec not found, skipping APK build step."
          fi
        continue-on-error: true

      - name: ğŸ‘‘ Upload Ready APK
        uses: actions/upload-artifact@v4
        with:
          name: Sovereign_Titan_Game_APK
          path: bin/*.apk
